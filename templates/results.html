{%extends "layout.html" %}
{% block content %}

{% macro build_block(things, idname) %} <!--Pass a list to create a block with those elements-->
    {% for i in range(things|length) %}
    <div class="tooltip">
    <p class="insidetext" id={{idname + (i+1)|string }}>{{things[i][0]}}</p> <!--Dont mind the red, this is fine-->
    <span class="tooltiptext" id ={{idname +'t'+ (i+1)|string}}>{{things[i][1]}}</span>         
    </div>      
    {%endfor%}
{% endmacro %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 

<script type="text/javascript">

    var value = "oh no"

    window.onload = function() {
        value = "{{settings}}"; 
    }

    function test(){
        console.log("test")
    }

    function sendData(){ 
        $.ajax({ 
            url: '/process', 
            type: 'POST', 
            contentType: 'application/json', 
            data: JSON.stringify({ 'value': value }),
            dataType: 'json', 
            success: function(response) { 
                console.log("here we are")
                console.log(response.result[0][0]);
                for (i=0; i < (document.getElementById('Genrebox').children).length;  i++){
                    (document.getElementById('Genrebox').children[i].children[0]).innerHTML = response.result[0][i][0];
                    (document.getElementById('Genrebox').children[i].children[1]).innerHTML = response.result[0][i][1];
                } 
                for (i=0; i < (document.getElementById('Settingbox').children).length;  i++){
                    (document.getElementById('Settingbox').children[i].children[0]).innerHTML = response.result[2][i][0];
                    (document.getElementById('Settingbox').children[i].children[1]).innerHTML = response.result[2][i][1];
                } 
                for (i=0; i < (document.getElementById('Mechanicbox').children).length;  i++){
                    (document.getElementById('Mechanicbox').children[i].children[0]).innerHTML = response.result[1][i][0];
                    (document.getElementById('Mechanicbox').children[i].children[1]).innerHTML = response.result[1][i][1];
                } 

            }, 
            error: function(error) { 
                console.log(error); 
                console.log('uh oh');
            } 
        });
    } 
</script>

<p class="spacer">Uh Oh! something's broken. Call 111 for assistance</p>

<div class="page">

    <div class="buttongrid">
    <button id = "reroll" class="settingbutton" onclick="sendData()">Reroll</button>
    <button id = "saveres" class="settingbutton" onclick="test()">Save Results</button>
    <button id = "viewsavedres" class="settingbutton">View Saved Results</button>
    </div>

<div id = 'Genrebox' class = 'multicontainer'>
    {{build_block(gchoice, 'gen')}}

</div>
<div id = 'Settingbox' class = 'multicontainer'>
    {{build_block(schoice , 'set')}}
    
</div>
<div id = 'Mechanicbox' class = 'multicontainer'>
    {{build_block(mchoice, 'mec')}}
    
</div>
</div>
{%endblock%}